"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.createMySqlPool = void 0;
const mysql_1 = __importDefault(require("mysql"));
const Pool_1 = __importDefault(require("mysql/lib/Pool"));
const Connection_1 = __importDefault(require("mysql/lib/Connection"));
const knex_1 = require("./knex");
const bluebird_1 = __importDefault(require("bluebird"));
bluebird_1.default.promisifyAll([Pool_1.default, Connection_1.default]);
/**
 * Attempts to connect to the database by the connection string.
 *
 * This returns a mysql pool connection object.
 */
const createMySqlPool = (connectionString) => {
    const { connection } = (0, knex_1.getConnectionData)(connectionString);
    const config = {
        ...connection,
        multipleStatements: true,
        connectTimeout: 30000,
        charset: 'utf8mb4'
    };
    return mysql_1.default.createPool(config);
};
exports.createMySqlPool = createMySqlPool;
